# Phase 5 完整功能測試指南

**測試日期**：2025-10-09
**版本**：v0.5.0
**階段**：Phase 5 (全部 5 個階段)

---

## 測試前準備

### 清除資料
訪問 http://localhost:3000/clear-data.html 清除所有測試資料

---

## 測試流程（按順序執行）

### 第一步：登入系統測試

#### 1.1 首次訪問
1. 訪問 http://localhost:3000
2. **預期**：顯示登入頁面（因為未登入）
3. **檢查**：
   - ✓ 登入頁面樣式正確
   - ✓ 顯示系統名稱「Dash BPM」
   - ✓ 帳號/密碼欄位可輸入
   - ✓ 提示文字：「預設密碼為帳號」

#### 1.2 建立測試帳號
1. 在登入頁面，先在新分頁開啟：http://localhost:3000/clear-data.html
2. 點擊「初始化測試資料」（這會建立測試人員）
3. 關閉分頁，回到登入頁面

#### 1.3 登入測試
**測試案例 A：錯誤密碼**
- 帳號：user001
- 密碼：wrong
- **預期**：顯示「密碼錯誤」

**測試案例 B：不存在的帳號**
- 帳號：nouser
- 密碼：nouser
- **預期**：顯示「帳號不存在」

**測試案例 C：正確登入**
- 帳號：user001
- 密碼：user001（預設密碼 = 帳號）
- **預期**：
  - ✓ 登入成功
  - ✓ 跳轉到首頁（儀表板）
  - ✓ Header 顯示使用者名稱
  - ✓ 顯示「登出」按鈕

#### 1.4 登出測試
1. 點擊 Header 的「登出」按鈕
2. 確認登出提示
3. **預期**：
   - ✓ 返回登入頁面
   - ✓ 需要重新登入才能使用系統

---

### 第二步：建立基礎資料

#### 2.1 登入系統
- 使用 user001 登入

#### 2.2 建立部門
1. 進入「人員管理」→「部門管理」
2. 新增部門：
   - IT部
   - 人力資源部
   - 財務部

#### 2.3 建立人員
1. 進入「人員管理」→「人員列表」
2. 新增人員：
   - 張三（user002, IT部, 主管）
   - 李四（user003, IT部, 主管）
   - 王五（user004, 人力資源部, 主管）
   - 趙六（user005, 財務部, 主管）

---

### 第三步：建立測試表單（含條件欄位）

#### 3.1 建立請假申請表單
**表單名稱**：請假申請單（含條件判斷）

**欄位配置**：
1. 列 1：文字輸入 - 申請人（必填）
2. 列 2：日期 x2 - 開始日期、結束日期（必填）
3. 列 3：數字 - 請假天數 (**ID 設定為：days**，必填）
4. 列 4：下拉選單 - 請假類型（選項：病假、事假、特休）
5. 列 5：多行文字 - 請假事由

**重要**：請假天數欄位的 ID 必須設為 `days`，這是條件判斷的關鍵！

---

### 第四步：建立條件分支流程

#### 4.1 建立條件分支流程
**流程名稱**：請假天數條件分支

**流程設計**：
```
開始 → 條件判斷 → 結束
          ├─ [out-right] → 單簽(總經理) → 結束
          └─ [out-bottom] → 單簽(部門主管) → 結束
```

**節點配置**：

1. **開始節點**：已自動建立
2. **條件判斷節點**：
   - 拖曳「條件分支」到畫布
   - 點擊節點，在右側屬性面板設定：

**規則 1：請假天數大於 3**
   - 點擊「+ 新增規則」
   - 規則名稱：請假天數 > 3
   - 輸出點：右側 (out-right)
   - 條件邏輯：全部符合 (AND)
   - 點擊「+ 新增條件」：
     - 欄位：days
     - 運算子：大於 (>)
     - 比較值：3
   - 點擊「儲存」

**規則 2：請假天數小於等於 3**
   - 點擊「+ 新增規則」
   - 規則名稱：請假天數 ≤ 3
   - 輸出點：下方 (out-bottom)
   - 條件邏輯：全部符合 (AND)
   - 點擊「+ 新增條件」：
     - 欄位：days
     - 運算子：小於等於 (<=)
     - 比較值：3
   - 點擊「儲存」

**預設分支**：
   - 選擇：下方 (out-bottom)

3. **單簽節點 x 2**：
   - 拖曳兩個「單簽」節點
   - 第一個命名：總經理審核，選擇簽核人：趙六
   - 第二個命名：部門主管審核，選擇簽核人：李四

4. **結束節點 x 2**：
   - 拖曳兩個「結束」節點

5. **連接節點**（注意輸出點）：
   - 開始 → 條件判斷
   - 條件判斷 [右側 out-right] → 單簽(趙六)
   - 條件判斷 [下方 out-bottom] → 單簽(李四)
   - 單簽(趙六) → 結束1
   - 單簽(李四) → 結束2

6. **儲存流程**

---

### 第五步：測試條件分支功能

#### 5.1 測試案例 A：請假 2 天（應走部門主管）

1. 進入「發起申請」
2. 選擇表單：請假申請單（含條件判斷）
3. 選擇流程：請假天數條件分支
4. 填寫資料：
   - 申請人：user001
   - 開始日期：2025/10/10
   - 結束日期：2025/10/11
   - **請假天數：2**
   - 請假類型：病假
   - 請假事由：身體不適
5. 提交申請

**預期結果**：
- ✓ 提交成功
- ✓ 顯示申請編號（格式：20251009-001）
- ✓ 進入「簽核中心」查看詳情
- ✓ 目前節點：部門主管審核
- ✓ 待簽核人員：李四
- ✓ 簽核歷史顯示：
  - 發起申請
  - **條件符合：請假天數 ≤ 3，走 out-bottom 分支**

#### 5.2 測試案例 B：請假 5 天（應走總經理）

1. 重複步驟 5.1，但修改：
   - **請假天數：5**

**預期結果**：
- ✓ 目前節點：總經理審核
- ✓ 待簽核人員：趙六
- ✓ 簽核歷史顯示：
  - 發起申請
  - **條件符合：請假天數 > 3，走 out-right 分支**

#### 5.3 完成簽核
1. 登出 user001
2. 登入 user003（李四）
3. 進入「簽核中心」→「待我簽核」
4. 核准申請編號 001（2天請假）
5. **預期**：狀態變為「已通過」

---

### 第六步：報表統計測試

#### 6.1 查看總覽統計
1. 登入任一帳號
2. 進入「報表統計」
3. 點擊「📈 總覽統計」

**預期顯示**：
- ✓ 總申請數：2
- ✓ 待審核：1
- ✓ 已通過：1
- ✓ 已退回：0
- ✓ 申請狀態分布圖例
- ✓ 最近申請記錄表格

#### 6.2 查看部門分析
1. 點擊「🏢 部門分析」

**預期顯示**：
- ✓ 各部門申請數量長條圖
- ✓ 部門詳細統計表
- ✓ 依照當前登入使用者的部門顯示數據

#### 6.3 查看時間趨勢
1. 點擊「📅 時間趨勢」

**預期顯示**：
- ✓ 申請數量趨勢圖（最近30天）
- ✓ 整體通過率
- ✓ 趨勢圖表正確顯示

#### 6.4 查看效率分析
1. 點擊「⚡ 效率分析」

**預期顯示**：
- ✓ 平均處理時間
- ✓ 已處理申請數
- ✓ 處理中申請數
- ✓ 簽核人員處理量 Top 10

---

### 第七步：權限管理測試

#### 7.1 一般員工權限
1. 登入 user001（一般員工）
2. **可訪問**：
   - ✓ 儀表板
   - ✓ 發起申請
   - ✓ 簽核中心（僅看自己的）
   - ✓ 報表統計
3. **不可訪問**：
   - 表單管理
   - 流程管理
   - 人員管理

#### 7.2 主管權限
1. 登入 user003（主管）
2. **可訪問**：
   - ✓ 全部功能
   - ✓ 可以簽核
   - ✓ 可以查看部門統計

---

### 第八步：使用者體驗測試

#### 8.1 跨頁面導航
- ✓ 點擊 Header 各選單項目可正確跳轉
- ✓ 當前頁面高亮顯示
- ✓ 頁面切換流暢

#### 8.2 使用者資訊顯示
- ✓ Header 顯示使用者名稱
- ✓ Header 顯示使用者部門
- ✓ 登出按鈕可正常運作

#### 8.3 申請人資訊自動填入
1. 登入任一使用者
2. 發起申請
3. **預期**：
   - ✓ 申請人自動填入當前使用者名稱
   - ✓ 部門自動填入當前使用者部門
   - ✓ 報表統計中可看到正確的部門數據

---

## 完整功能檢查清單

### 階段 1：條件分支執行邏輯
- [ ] ConditionEvaluator 正確評估條件
- [ ] 支援所有運算子 (>, <, >=, <=, ==, !=, contains, etc.)
- [ ] AND/OR 邏輯正確運作
- [ ] 條件節點 UI 設定正常
- [ ] 規則優先順序正確
- [ ] 預設分支正確運作
- [ ] 條件節點自動評估（不需人工簽核）
- [ ] 簽核歷史正確記錄條件判斷結果

### 階段 2：報表統計與圖表
- [ ] 總覽統計卡片顯示正確
- [ ] 狀態分布圖例正確
- [ ] 部門分析長條圖顯示正確
- [ ] 部門統計表數據正確
- [ ] 時間趨勢圖顯示正確
- [ ] 通過率計算正確
- [ ] 效率分析數據正確
- [ ] 簽核人員處理量統計正確

### 階段 3：使用者登入系統
- [ ] 登入頁面顯示正確
- [ ] 帳號密碼驗證正確
- [ ] 預設密碼機制正常
- [ ] 登入成功跳轉正確
- [ ] 登出功能正常
- [ ] 未登入時強制跳轉登入頁面
- [ ] 使用者資訊正確儲存

### 階段 4：權限管理
- [ ] authService 正確判斷使用者角色
- [ ] isManager() 方法正常
- [ ] isAdmin() 方法正常
- [ ] getCurrentUser() 回傳正確資訊
- [ ] 登入狀態持久化
- [ ] 密碼修改功能（預留）

### 階段 5：表單版本控制
- [ ] 表單版本號正確記錄（基礎實作）
- [ ] 版本欄位已加入 dataModel

### 整合測試
- [ ] 登入 → 發起申請 → 簽核 → 報表查看 完整流程
- [ ] 條件分支在實際申請中正確運作
- [ ] 不同使用者登入看到不同的資料
- [ ] 部門統計依使用者部門正確顯示
- [ ] 所有頁面樣式一致
- [ ] 無 console 錯誤

---

## 已知問題與限制

1. **登入系統**：
   - 密碼未加密（簡化版實作）
   - 無「忘記密碼」功能
   - Session 僅存於 LocalStorage

2. **權限管理**：
   - 基礎權限判斷已實作
   - 頁面級權限控制待完善
   - 功能級權限控制待實作

3. **表單版本控制**：
   - 僅加入版本欄位
   - 版本比較功能待實作
   - 版本回復功能待實作

4. **報表統計**：
   - 使用純 CSS 圖表（無外部依賴）
   - 圖表功能較基礎
   - 無匯出功能

---

## 測試完成確認

**測試日期**：_____________

**測試人員**：_____________

**測試結果**：

| 階段 | 功能 | 結果 | 備註 |
|------|------|------|------|
| 1 | 條件分支執行邏輯 | ⬜ 通過 / ⬜ 失敗 | |
| 2 | 報表統計與圖表 | ⬜ 通過 / ⬜ 失敗 | |
| 3 | 使用者登入系統 | ⬜ 通過 / ⬜ 失敗 | |
| 4 | 權限管理 | ⬜ 通過 / ⬜ 失敗 | |
| 5 | 表單版本控制 | ⬜ 通過 / ⬜ 失敗 | |
| 整合 | 完整流程測試 | ⬜ 通過 / ⬜ 失敗 | |

**總結**：

⬜ 全部測試通過，Phase 5 完成
⬜ 有問題需要修復

**發現問題**：

1.

**下一步**：

1.
