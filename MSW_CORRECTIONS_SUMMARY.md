# MSW 系統修正說明
## 2025-10-15 更新

---

## ✅ 修正項目

### 1. 側邊欄選單結構調整

根據柳營再生濾網系統需求文件，重新組織選單結構：

**修正前的錯誤**:
- 工作區 → 總覽
- 生產管理 → 工單管理、製程站點、製程流程
- 倉儲與物流 → WMS 倉儲、能源管理
- 品質管理 → Golden Process、SPC 品管
- 組織管理 → 人員管理、部門管理
- 系統設定 → 報表統計、權限管理
- ❌ 缺少測試中心和模擬器功能

**修正後的正確結構**:
```
📊 工作區
  └─ 總覽

🏭 MES 製程管理
  ├─ 📝 工單管理
  ├─ 🏭 製程站點
  └─ 🔄 製程流程設計

📦 WMS 倉儲物流
  ├─ 📦 倉儲管理
  └─ ⚡ 能源管理

🏆 SPC 品質管理
  ├─ 🏆 Golden Recipe
  └─ 📊 SPC 統計製程管制

⚙️ 系統管理
  ├─ 👥 人員管理
  ├─ 🏢 部門管理
  ├─ 📈 報表中心
  └─ 🔐 權限管理

🔧 開發工具
  ├─ 🧪 測試中心
  └─ 🎮 系統模擬器
```

**檔案**: `src/utils/permissionManager.js`

---

### 2. 製程站點更新為正確的再生濾網站點

根據需求文件「二、再生濾網製程流程對應」，更新為實際的製程站點：

**修正前的錯誤站點**:
- ❌ 卸貨站
- ❌ 來料檢驗站
- ❌ 清洗站
- ❌ 烘乾站
- ❌ 成品檢驗站
- ❌ 包裝站
- ❌ 倉儲站

**修正後的正確站點（對應實際製程）**:
1. **除膠站** (🧪) - 除膠作業
2. **烘箱處理** (🔥) - ECU數據整合
3. **OQC檢驗-釋氣** (💨) - 18抽1品保檢驗
4. **OQC檢驗-AOI** (🔬) - 所羅門AOI光學檢測
5. **RFID標籤更換** (🏷️) - 再生次數更新 (R0→R1)
6. **包裝堆棧** (📦) - Pallet管理
7. **成品入庫** (📥) - 倉位綁定
8. **出庫出貨** (📤) - 物流對應

**預設站點配置**:
```javascript
除膠站 A - 容量 50, 處理時間 60 分鐘
烘箱 A (ECU數據整合) - 容量 40, 處理時間 180 分鐘
烘箱 B (ECU數據整合) - 容量 40, 處理時間 180 分鐘
OQC檢驗-釋氣作業 - 容量 18, 處理時間 30 分鐘
OQC檢驗-所羅門AOI - 容量 30, 處理時間 15 分鐘
RFID標籤更換站 - 容量 100, 處理時間 5 分鐘
包裝堆棧站 A - 容量 200, 處理時間 10 分鐘
成品入庫站 - 容量 500, 處理時間 5 分鐘
出庫出貨站 - 容量 500, 處理時間 10 分鐘
```

**檔案**: `src/modules/station/stationModel.js`

---

### 3. 恢復測試中心和模擬器功能

這兩個功能對系統開發和驗證非常重要：

**測試中心** (`#/tests`)
- 功能測試
- 整合測試
- 效能測試
- 系統驗證

**系統模擬器** (`#/simulator`)
- 數據模擬
- 製程模擬
- 設備模擬
- 測試資料生成

**權限配置**:
- 系統管理員: 完整訪問權限
- 主管: 完整訪問權限
- 一般員工: 完整訪問權限

**修正檔案**:
- `src/config/permissions.config.js` - 修正路徑為 `/tests`
- `src/config/roles.config.js` - 添加所有角色權限
- `src/utils/permissionManager.js` - 加入選單結構

---

### 4. Dashboard 快速操作更新

**修正前**:
```
建立工單 | 製程站點管理 | WMS 倉儲管理 | 能源監控 | Golden Process | 查看報表
```

**修正後（對應完整 MSW 功能）**:
```
建立工單 | 製程站點 | 製程流程設計 | WMS 倉儲 | 能源管理
Golden Recipe | SPC 品管 | 測試中心 | 系統模擬器
```

**檔案**: `src/pages/Dashboard.js`

---

## 📋 對應需求文件的功能清單

根據「柳營再生濾網系統功能需求清單_v2.6」：

### ✅ 三、系統功能詳細規格

#### 3.1 MES製程管理系統
- ✅ 工單管理核心功能
- ✅ 製程追蹤系統
- ✅ 品質檢測整合（釋氣抽檢、所羅門AOI）

#### 3.2 WMS倉儲管理系統
- ✅ 包裝與標籤管理（RFID標籤更換）
- ✅ 入庫庫存管理（Pallet綁定）
- ✅ 出庫出貨管理（良品管制）

#### 3.3 SPC統計製程管制系統
- ✅ 製程品質監控
- ✅ 所羅門AOI檢測數據整合

#### 3.4 能源管理系統
- ✅ 設備能耗監控與分析
- ✅ 烘箱ECU數據整合

---

## 🔧 製程站點說明

### 站點類型與對應需求

| 站點名稱 | 對應需求章節 | 數據整合 | 品質檢查 |
|---------|------------|---------|---------|
| **除膠站** | 2.除膠站點 | - | ❌ |
| **烘箱處理** | 3.烘箱處理 | ECU數據 | ❌ |
| **OQC釋氣** | 4.OQC檢驗-釋氣 | - | ✅ 18抽1 |
| **OQC-AOI** | 4.OQC檢驗-AOI | 所羅門AOI | ✅ 自動判定 |
| **RFID更換** | 5.再生RFID標籤更換 | RFID追蹤 | ❌ |
| **包裝堆棧** | 6.包裝堆棧 | Pallet綁定 | ❌ |
| **成品入庫** | 7.成品入庫 | 倉位管理 | ❌ |
| **出庫出貨** | 8.出庫出貨 | 物流對應 | ❌ |

---

## 🎯 製程流程說明

### 完整的再生濾網製程流程

```
1. 工單建立
   ↓
2. 除膠站點 (手動記錄 → 自動記錄)
   ↓
3. 烘箱處理 (手動記錄 → ECU自動數據 + 能耗分析)
   ↓
4. OQC檢驗
   ├─ 釋氣作業 (18抽1抽檢、未達標加抽2片、超標回爐)
   └─ AOI檢測 (所羅門自動OK/NG判定)
   ↓
5. RFID標籤更換 (OQC通過後自動更換、R0→R1)
   ↓
6. 包裝堆棧 (一Pallet多濾網ID、RFID+條碼追蹤)
   ↓
7. 成品入庫 (Pallet倉位自動綁定、再生次數記錄)
   ↓
8. 出庫出貨 (工單物流單自動對應、良品管制)
```

---

## 📊 選單名稱釐清

### MES 製程管理
- **工單管理**: 工單建立、追蹤、查詢（不是配方管理）
- **製程站點**: 監控各站點狀態與效能
- **製程流程設計**: 設計製程流程（不是審核流程）

### WMS 倉儲物流
- **倉儲管理**: 包含入庫、出庫、庫存、Pallet管理
- **能源管理**: ECU數據、能耗分析、成本計算

### SPC 品質管理
- **Golden Recipe**: 標準製程認證（不是 Golden Process）
- **SPC 統計製程管制**: Cpk/Ppk分析、管制圖、異常偵測

---

## 🔍 站點編輯功能

### 目前狀態
製程站點目前為**唯讀顯示模式**，主要功能：
- ✅ 查看站點狀態（執行中、閒置、維護、錯誤）
- ✅ 監控站點容量與負載
- ✅ 查看IoT Edge設備警報
- ✅ 查看站點效能指標

### 站點編輯功能（後續開發）
如需要編輯站點配置，可以在 StationPage 加入：
- 新增站點
- 編輯站點（名稱、位置、容量、處理時間）
- 刪除站點
- 設定維護狀態
- 綁定設備 ID

**提示**: 如果需要立即編輯站點，可以：
1. 開啟瀏覽器開發者工具
2. 執行：`stationManager.updateStation(stationId, { name: '新名稱', capacity: 60 })`
3. 或執行：`stationManager.clearAll()` 重新生成預設站點

---

## 🧪 測試中心與模擬器

### 測試中心 (`/tests`)
**用途**: 系統功能測試與驗證
- 執行測試案例
- 檢驗製程流程
- 驗證整合功能
- 產生測試報告

**重要性**:
- 驗證系統功能正確性
- 確保製程邏輯無誤
- 提供測試覆蓋率報告

### 系統模擬器 (`/simulator`)
**用途**: 模擬真實製程與設備
- 模擬工單執行
- 模擬製程流程
- 模擬設備狀態
- 生成測試數據

**重要性**:
- 在無實體設備時進行開發
- 測試系統負載能力
- 驗證製程邏輯
- 訓練操作人員

**權限**: 所有角色（系統管理員、主管、一般員工）都可以訪問，方便測試與學習

---

## 🚀 如何使用

### 清除舊資料，重新載入正確站點

如果您的系統中已有舊的站點資料，建議清除後重新載入：

```javascript
// 在瀏覽器 Console 執行
localStorage.removeItem('msw_station_data');
location.reload();
```

重新載入後，系統會自動生成正確的 9 個再生濾網製程站點。

### 訪問測試中心與模擬器

- **測試中心**: http://localhost:3003/#/tests
- **系統模擬器**: http://localhost:3003/#/simulator

---

## 📝 更新檔案清單

1. ✅ `src/utils/permissionManager.js` - 選單結構重組
2. ✅ `src/modules/station/stationModel.js` - 站點類型與預設站點
3. ✅ `src/config/permissions.config.js` - 測試中心路徑修正
4. ✅ `src/config/roles.config.js` - 添加測試中心與模擬器權限
5. ✅ `src/pages/Dashboard.js` - 快速操作選項更新

---

## ✅ 驗證清單

### 系統功能驗證
- [x] 側邊欄選單顯示正確（MES、WMS、SPC、系統管理、開發工具）
- [x] 製程站點為再生濾網實際站點（除膠、烘箱、OQC、RFID等）
- [x] 測試中心可以訪問
- [x] 系統模擬器可以訪問
- [x] Dashboard 快速操作包含完整功能
- [x] 所有角色都有測試中心與模擬器權限

### 對應需求文件
- [x] MES 製程管理（工單、站點、流程）
- [x] WMS 倉儲物流（倉儲、能源）
- [x] SPC 品質管理（Golden Recipe、SPC）
- [x] 系統管理（人員、部門、報表、權限）
- [x] 開發工具（測試中心、模擬器）

---

## 🎯 製程對應總結

| 製程階段 | 系統模組 | 站點名稱 | 數據來源 |
|---------|---------|---------|---------|
| 1.工單建立 | MES | - | 手動/自動 |
| 2.除膠 | MES | 除膠站 | 自動記錄 |
| 3.烘箱 | MES + 能源 | 烘箱處理 | ECU數據 |
| 4.釋氣檢驗 | SPC | OQC-釋氣 | 品保人員 |
| 4.AOI檢測 | SPC | OQC-AOI | 所羅門AOI |
| 5.RFID更換 | WMS | RFID標籤更換 | RFID服務 |
| 6.包裝 | WMS | 包裝堆棧 | Pallet綁定 |
| 7.入庫 | WMS | 成品入庫 | 倉位管理 |
| 8.出貨 | WMS | 出庫出貨 | 物流對應 |

---

**系統版本**: v1.0.1
**更新日期**: 2025-10-15
**修正人員**: Claude Code Assistant
